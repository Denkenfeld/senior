<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mein Kalender</title>
    <style>
        body {
            margin: 0; padding: 0; height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex; flex-direction: column; background-color: #ffffff; overflow: hidden;
        }

        header {
            height: 60px; background-color: #ffffff; border-bottom: 1px solid #e0e0e0;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 24px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); z-index: 10;
        }

        h1 { font-size: 20px; font-weight: 400; color: #3c4043; margin: 0; display: flex; align-items: center; gap: 10px; }
        
        .btn-edit {
            background-color: #1a73e8; color: #ffffff; border: none; height: 36px; padding: 0 24px;
            border-radius: 4px; font-weight: 500; font-size: 14px; cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 8px;
            transition: background 0.2s;
        }
        .btn-edit:hover { background-color: #1765cc; }

        main { flex: 1; position: relative; width: 100%; background: #fff; }

        iframe { width: 100%; height: 100%; border: none; display: block; }
        
        /* Lade-Overlay */
        #loading {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.8); display: none;
            align-items: center; justify-content: center; z-index: 20;
            color: #1a73e8; font-weight: 500;
        }
    </style>
</head>
<body>

    <header>
        <h1>
            <svg style="width:24px;height:24px;fill:#1a73e8" viewBox="0 0 24 24">
                <path d="M19,4H18V2H16V4H8V2H6V4H5A2,2 0 0,0 3,6V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V6A2,2 0 0,0 19,4M19,20H5V10H19V20M19,8H5V6H19V8Z" />
            </svg>
            Wochenplaner
        </h1>
        <button class="btn-edit" onclick="openEditor()">
            <span>✎</span> Termine bearbeiten
        </button>
    </header>

    <main>
        <div id="loading">Aktualisiere Kalender...</div>
        <iframe 
            id="cal-frame"
            src="https://calendar.google.com/calendar/embed?src=vitakreisbalingen%40gmail.com&ctz=Europe%2FBerlin&mode=WEEK&showTitle=0&showPrint=0&showTabs=0&showCalendars=0&showTz=0"
            scrolling="no">
        </iframe>
    </main>

    <script>
        function openEditor() {
            const w = 1200; const h = 800;
            const left = (window.screen.width - w) / 2;
            const top = (window.screen.height - h) / 2;

            // FIX: Parameter authuser hinzugefügt, um das richtige Konto zu erzwingen
            const accountEmail = 'vitakreisbalingen@gmail.com';
            
            const popup = window.open(
                `https://calendar.google.com/calendar/r/week?authuser=${accountEmail}`, 
                'GoogleCalEdit', 
                `width=${w},height=${h},top=${top},left=${left},resizable=yes,scrollbars=yes`
            );

            const timer = setInterval(() => { 
                if (popup.closed) {
                    clearInterval(timer);
                    reloadCalendar();
                }
            }, 500);
        }

        function reloadCalendar() {
            const iframe = document.getElementById('cal-frame');
            const loading = document.getElementById('loading');
            
            loading.style.display = 'flex';
            iframe.src = iframe.src;

            iframe.onload = function() {
                loading.style.display = 'none';
            };
        }
    </script>

</body>
</html>
