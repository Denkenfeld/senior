<section class="faq-wrap reveal">
        <div class="faq-img-container">
            <h2>Häufige Fragen zur Betreuung</h2>
            <img src="https://denkenfeld.github.io/senior/20-fragen.jpg" class="faq-img" alt="Studio Detail" style="margin-top: 35px;">
        </div>
        <div class="faq-content">
            <div class="faq-item">
                <div class="faq-question">Ort & Abrechnung <i class="fa-solid fa-chevron-down faq-icon"></i></div>
                <div class="faq-answer">
                    <p style="margin-bottom: 12px;"><strong>Wo findet die Betreuung statt?</strong><br>Wir besprechen alles vorab. Ich komme zu Ihnen oder wir treffen uns an einem vereinbarten Ort.</p>
                    <p style="margin-bottom: 12px;"><strong>Kann ich über die Kasse abrechnen?</strong><br>Nein, eine Abrechnung über den Entlastungsbetrag der Pflegekasse ist aktuell noch nicht möglich, wird aber künftig eine Option werden.</p>
                    <p><strong>Was machen wir genau?</strong><br>Ich stelle mich ganz auf Ihre Wünsche ein. Ob Ruhe oder Aktivität – wir gestalten die Zeit so, wie es Ihnen gut tut.</p>
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Zeit & Dauer <i class="fa-solid fa-chevron-down faq-icon"></i></div>
                <div class="faq-answer">
                    <p style="margin-bottom: 12px;"><strong>Wie flexibel sind die Zeiten?</strong><br>Ganz flexibel. Von einer Stunde bis zu einem ganzen Nachmittag oder regelmäßigen Terminen.</p>
                    <p style="margin-bottom: 12px;"><strong>Dürfen Angehörige dabei sein?</strong><br>Selbstverständlich. Ein erstes Kennenlernen mit Angehörigen ist oft sehr hilfreich.</p>
                    <p><strong>Wann merke ich eine Entlastung?</strong><br>Sie merken sofort, wie gut es tut, Unterstützung zu haben. Wir reflektieren regelmäßig gemeinsam.</p>
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Abrechnung & Vertrauen <i class="fa-solid fa-chevron-down faq-icon"></i></div>
                <div class="faq-answer">
                    <p style="margin-bottom: 12px;"><strong>Wie erfolgt die Abrechnung?</strong><br>Sie erhalten eine ordentliche Rechnung, die Sie ggf. bei der Steuer absetzen können.</p>
                    <p style="margin-bottom: 12px;"><strong>Worauf kann ich mich verlassen?</strong><br>Ich bin zuverlässig, pünktlich und habe ein offenes Ohr für alle Sorgen und Nöte.</p>
                    <p><strong>Ist alles vertraulich?</strong><br>Diskretion ist für mich selbstverständlich. Alle Gespräche bleiben vertraulich.</p>
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Leistungen & Alltag <i class="fa-solid fa-chevron-down faq-icon"></i></div>
                <div class="faq-answer">
                    <p style="margin-bottom: 12px;"><strong>Übernehmen Sie auch Erledigungen?</strong><br>Gerne übernehme ich Einkäufe, Fahrten zum Arzt oder Behördengänge für Sie.</p>
                    <p style="margin-bottom: 12px;"><strong>Wie gestalten wir die Freizeit?</strong><br>Ein Lächeln gehört dazu, aber auch Ernsthaftigkeit wenn nötig. Wir schauen gemeinsam, was Ihnen Freude macht.</p>
                    <p><strong>Wie schnell bekomme ich einen Termin?</strong><br>Ich versuche, Termine zeitnah möglich zu machen. Rufen Sie einfach an.</p>
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Hausbesuche & Termine <i class="fa-solid fa-chevron-down faq-icon"></i></div>
                <div class="faq-answer">
                    <p style="margin-bottom: 12px;"><strong>Kommen Sie zu mir nach Hause?</strong><br>Ja, ich komme direkt zu Ihnen nach Hause oder ins Pflegeheim.</p>
                    <p style="margin-bottom: 12px;"><strong>Auch am Wochenende?</strong><br>Ja, nach Absprache sind auch Termine am Wochenende möglich.</p>
                    <p><strong>Haben Sie noch Fragen?</strong><br>Rufen Sie an! Wir klären alles in einem persönlichen Gespräch.</p>
                </div>
            </div>
        </div></section>

    <section class="faq-wrap reveal">
        <div class="faq-img-container">
            <div class="about-bubble">
                <h3 style="font-size: 1.5rem; margin-bottom: 15px; margin-top: 5px;">Gemeinsam statt einsam.</h3> 
                <p style="color: #444; line-height: 1.6; margin-bottom: 40px; margin-top: 15px;text-align: center;">Vitakreis startet 2026 als dynamisches Startup mit der Mission, durch erstklassigen Service aus einer Hand die beste Hilfe im Alltag zu bieten. Wir stehen für Qualität und das Motto „Gemeinsam statt einsam“, um täglich Freude zu schenken und Wohlbefinden zum Maßstab zu machen. <br><br><strong>Werden Sie Teil unserer Vision – wir bieten motivierten Talenten und Unternehmern von Tag eins an Raum für gemeinsames Wachstum und echte Aufstiegschancen. </strong></p>
                <div class="artist-circle-wrapper" id="artistCircle" style="margin: 0 auto;">
                    <img src="https://denkenfeld.github.io/senior/23-team-kreis.png" class="artist-avatar" alt="Irene" id="artistImg">
                    <video class="artist-video" id="artistVideo" muted playsinline>
                        <source src="https://denkenfeld.github.io/senior/24-kreis-video.mp4" type="video/mp4">
                    </video>
                    <div class="flash-overlay" id="flashOverlay"></div>
                    <i class="fa-solid fa-play play-hint"></i>
                </div>
            </div>
        </div>
        <div class="faq-content">
            <h2 style="margin-bottom: 10px;">Kommen Sie in unser Team!</h2>
            <h3 style="font-size: 1.2rem; margin-bottom: 25px; color: #D96C4A;">Offene Stellen in Balingen</h3>

            <div class="faq-item">
                <div class="faq-question">Alltagsbegleiter/in <i class="fa-solid fa-chevron-down faq-icon"></i></div>
                <div class="faq-answer">
                    <p style="margin-bottom: 12px;"><strong>Ihre Aufgaben:</strong><br>Sie begleiten Senioren im Alltag, unterstützen bei Spaziergängen, Einkäufen und bieten soziale Betreuung. Mit Empathie und Geduld schenken Sie Lebensqualität.</p>
                    <p style="margin-bottom: 12px;"><strong>Ihr Profil:</strong><br>Einfühlungsvermögen, Zuverlässigkeit und Freude am Umgang mit älteren Menschen. Erfahrung ist willkommen, aber keine Voraussetzung.</p>
                    <p style="margin-bottom: 12px;"><strong>Wir bieten:</strong><br>Flexible Arbeitszeiten, faire Vergütung, ein herzliches Team und sinnvolle Arbeit, die wirklich etwas bewegt.</p>
                    
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Pflegefachkraft (m/w/d) <i class="fa-solid fa-chevron-down faq-icon"></i></div>
                <div class="faq-answer">
                    <p style="margin-bottom: 12px;"><strong>Ihre Aufgaben:</strong><br>Professionelle Pflege und Betreuung von Senioren, Unterstützung bei medizinischen Maßnahmen und enge Zusammenarbeit mit Ärzten und Angehörigen.</p>
                    <p style="margin-bottom: 12px;"><strong>Ihr Profil:</strong><br>Abgeschlossene Ausbildung als Pflegefachkraft, Altenpfleger/in oder vergleichbare Qualifikation. Teamgeist und Verantwortungsbewusstsein.</p>
                    <p style="margin-bottom: 12px;"><strong>Wir bieten:</strong><br>Attraktive Bezahlung, Fort- und Weiterbildungsmöglichkeiten, familiäres Arbeitsklima und Wertschätzung Ihrer Arbeit.</p>
                    
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Quereinsteiger/in willkommen <i class="fa-solid fa-chevron-down faq-icon"></i></div>
                <div class="faq-answer">
                    <p style="margin-bottom: 12px;"><strong>Ihre Aufgaben:</strong><br>Unterstützung im Alltag unserer Klienten – von Haushaltstätigkeiten bis zur Gesellschaft. Sie wachsen mit Ihren Aufgaben und erhalten umfassende Einarbeitung.</p>
                    <p style="margin-bottom: 12px;"><strong>Ihr Profil:</strong><br>Motivation, Lernbereitschaft und ein großes Herz. Berufserfahrung in der Pflege ist nicht erforderlich – wir bilden Sie aus!</p>
                    <p style="margin-bottom: 12px;"><strong>Wir bieten:</strong><br>Strukturierte Einarbeitung, persönliche Begleitung, faire Bezahlung und die Chance auf einen beruflichen Neustart mit Sinn.</p>
                    
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Vertrieb & Kundenbetreuung <i class="fa-solid fa-chevron-down faq-icon"></i></div>
                <div class="faq-answer">
                    <p style="margin-bottom: 12px;"><strong>Ihre Aufgaben:</strong><br>Beratung von Interessenten und Angehörigen, Akquise neuer Kunden, Aufbau langfristiger Beziehungen und Repräsentation unseres Unternehmens.</p>
                    <p style="margin-bottom: 12px;"><strong>Ihr Profil:</strong><br>Kommunikationsstärke, Verkaufstalent und Empathie. Erfahrung im Vertrieb oder Kundenservice ist von Vorteil.</p>
                    <p style="margin-bottom: 12px;"><strong>Wir bieten:</strong><br>Attraktives Gehaltsmodell mit Provisionen, Homeoffice-Möglichkeit, eigenverantwortliches Arbeiten und ein wachsendes Unternehmen mit Perspektiven.</p>
                    
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Web Developer (m/w/d) <i class="fa-solid fa-chevron-down faq-icon"></i></div>
                <div class="faq-answer">
                    <p style="margin-bottom: 12px;"><strong>Ihre Aufgaben:</strong><br>Entwicklung und Pflege unserer Website, Implementierung von Buchungssystemen, SEO-Optimierung und digitale Weiterentwicklung unserer Online-Präsenz.</p>
                    <p style="margin-bottom: 12px;"><strong>Ihr Profil:</strong><br>Erfahrung in HTML, CSS, JavaScript und idealerweise modernen Frameworks. Kreativität, technisches Know-how und Lust auf ein soziales Projekt.</p>
                    <p style="margin-bottom: 12px;"><strong>Wir bieten:</strong><br>Flexible Arbeitszeiten, Remote-Arbeit möglich, spannende Projekte mit gesellschaftlichem Mehrwert und ein motiviertes Team.</p>
                    
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Initiativbewerbung <i class="fa-solid fa-chevron-down faq-icon"></i></div>
                <div class="faq-answer">
                    <p style="margin-bottom: 12px;"><strong>Sie haben andere Talente?</strong><br>Wir sind offen für alle, die mit Leidenschaft und Engagement dabei sein möchten. Ob Verwaltung, Marketing, Ehrenamt oder ganz andere Bereiche.</p>
                    <p style="margin-bottom: 12px;"><strong>Ihre Chance:</strong><br>Werden Sie Teil eines wachsenden Teams, das täglich etwas bewegt. Wir freuen uns auf Ihre Ideen und Ihr Können!</p>
                    <p style="margin-bottom: 12px;"><strong>Wir bieten:</strong><br>Individuelle Gestaltungsmöglichkeiten, ein offenes und wertschätzendes Miteinander und die Chance, wirklich etwas zu bewegen.</p>
                    
                </div>
            </div>
        </div>
    </section>


    

    <div class="footer-container">
        <a href="#top" class="back-to-top"><i class="fa-solid fa-chevron-up"></i></a>
        <div class="footer-links">
            <p>Vitakreis - Alltagsbegleitung Balingen © 2026</p>
            <p><a onclick="openLegalModal()">Impressum</a> • <a onclick="openLegalModal()">Datenschutz</a> • <a onclick="openLegalModal()">AGB</a></p>
            <p><a href="https://www.vitakreis.de/login/" style="color: #777; text-decoration: none; margin: 0 10px; transition: 0.3s;">LOGIN</a></p>
        </div>
    </div>
</div>


</div>
<div id="legalModal" class="modal-overlay">
    <div class="modal-content">
        <button class="close-modal" onclick="closeLegalModal()">×</button>
        <div class="legal-text" id="legalContainer">
            <div style="display: flex; justify-content: center; align-items: center; height: 200px;">
                <i class="fa-solid fa-spinner fa-spin" style="font-size: 2rem; color: #ccc;"></i>
            </div>
        </div>
    </div>
</div>

<div id="requestModal" class="modal-overlay">
    <div class="modal-content">
        <button class="close-modal" onclick="closeRequestModal()">×</button>
        <div id="requestContainer">
            <div style="display: flex; justify-content: center; align-items: center; height: 200px;">
                <i class="fa-solid fa-spinner fa-spin" style="font-size: 2rem; color: #ccc;"></i>
            </div>
        </div>
    </div>
</div>

<a href="tel:07433-9970779" class="call-fab" id="smartBtn">
    <div class="fab-content">
        <div class="fab-text"><span style="font-size: 0.7rem; opacity: 0.7;">Mo-Sa 8-20h</span><span><span class="status-dot"></span>Jetzt anrufen</span></div>
        <i class="fa-solid fa-phone fab-icon"></i>
    </div>
</a>

<script src="assets/js/flatpickr.js"></script>
<script src="assets/js/de.js"></script>

<script>
    // --- MAIN SITE LOGIC ---
    document.querySelectorAll('.faq-question').forEach(item => { item.addEventListener('click', () => { item.parentElement.classList.toggle('active'); }); });
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('active'); });
    }, { threshold: 0.1 });
    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
    
    const heroImg = document.getElementById('heroImg');
    window.addEventListener('scroll', () => { if(window.pageYOffset < 1000) heroImg.style.transform = `translateY(${window.pageYOffset * 0.3}px)`; });

    let lastScrollTop = 0; const btn = document.getElementById('smartBtn');
    window.addEventListener('scroll', function() {
        let st = window.pageYOffset || document.documentElement.scrollTop;
        if (Math.abs(st - lastScrollTop) > 50) {
            if (st > lastScrollTop && st > 100) btn.classList.add('collapsed'); else btn.classList.remove('collapsed');
            lastScrollTop = st;
        }
    });

    // === NEW PHYSICS-BASED CAROUSEL (SAFARI & MOMENTUM) ===
    const wrap = document.getElementById('galleryWrap');
    const track = document.getElementById('galleryTrack');

    if (wrap && track) {
        // 1. Setup Duplicates
        const originalItems = Array.from(track.children);
        originalItems.forEach(item => track.appendChild(item.cloneNode(true)));

        // 2. Metrics
        function getItemWidth() {
            const first = track.querySelector('.gallery-item');
            if (!first) return 0;
            const styles = window.getComputedStyle(track);
            const gap = parseFloat(styles.columnGap || styles.gap || 0);
            return first.offsetWidth + gap;
        }

        let itemWidth = getItemWidth();
        let totalWidth = itemWidth * originalItems.length;

        // 3. Physics Variables
        let x = 0;
        let baseSpeed = 0.8; // Auto-scroll speed
        let speed = baseSpeed;
        
        let isDragging = false;
        let startX = 0;
        let lastX = 0;
        
        // Momentum & Tap Logic variables
        let velocity = 0;
        let lastFrameTime = 0;
        let isMomentum = false;
        let friction = 0.95; // 0.95 = smooth slide, lower = stops faster
        let resumeTimer = null;
        let totalDragDist = 0;

        function updateTransform() {
            track.style.transform = `translate3d(${x}px, 0, 0)`;
        }

        function loop(time) {
            // Delta time calculation for smoother velocity
            if (!lastFrameTime) lastFrameTime = time;
            const dt = time - lastFrameTime;
            lastFrameTime = time;

            if (isDragging) {
                // While dragging, we just follow the finger (logic in pointerMove)
                // but we track velocity here if needed, or in move. 
                // Currently velocity is tracked in move for simplicity.
            } else if (isMomentum) {
                // Momentum Phase: Apply velocity and friction
                x += velocity;
                velocity *= friction;

                // Stop momentum when slow enough
                if (Math.abs(velocity) < 0.1) {
                    isMomentum = false;
                    velocity = 0;
                    startResumeTimer();
                }
                
                // Boundaries
                if (x > 0) x -= totalWidth;
                if (Math.abs(x) >= totalWidth) x += totalWidth;
                updateTransform();

            } else {
                // Auto-Scroll Phase (only if speed is not 0)
                if (speed !== 0) {
                    x -= speed;
                    if (Math.abs(x) >= totalWidth) x += totalWidth;
                    updateTransform();
                }
            }
            requestAnimationFrame(loop);
        }

        function startResumeTimer() {
            if (resumeTimer) clearTimeout(resumeTimer);
            resumeTimer = setTimeout(() => {
                speed = baseSpeed; // Resume auto-scroll
            }, 1500); // 1.5s Pause
        }

        // --- POINTER EVENTS (TOUCH & MOUSE) ---
        function pointerDown(clientX) {
            isDragging = true;
            isMomentum = false;
            startX = clientX;
            lastX = clientX;
            totalDragDist = 0;
            velocity = 0;
            speed = 0; // Stop auto-scroll
            if (resumeTimer) clearTimeout(resumeTimer);
            
            wrap.classList.add('grabbing');
        }

        function pointerMove(clientX) {
            if (!isDragging) return;
            const delta = clientX - lastX;
            lastX = clientX;
            
            // Track total distance to distinguish Click/Tap from Drag
            totalDragDist += Math.abs(delta);

            // Move immediate
            x += delta;
            
            // Calculate velocity (pixels per frame roughly)
            // For very high refresh rates, this might need dt normalization, 
            // but for this visual effect direct delta is usually fine and "feels" direct.
            velocity = delta; 

            // Loop boundaries
            if (x > 0) x -= totalWidth;
            if (Math.abs(x) >= totalWidth) x += totalWidth;
            updateTransform();
        }

        function pointerUp() {
            if (!isDragging) return;
            isDragging = false;
            wrap.classList.remove('grabbing');

            // Check if it was just a TAP (minimal movement)
            if (totalDragDist < 5) {
                // It was a tap -> Pause!
                velocity = 0;
                isMomentum = false;
                startResumeTimer();
            } else {
                // It was a swipe -> Momentum!
                isMomentum = true;
                // Boost velocity slightly for "Schwung" feeling if needed, 
                // or just keep raw delta. 
                // velocity = velocity * 1.2; 
            }
        }

        // Mouse Listeners
        wrap.addEventListener('mousedown', e => { e.preventDefault(); pointerDown(e.clientX); });
        window.addEventListener('mousemove', e => pointerMove(e.clientX));
        window.addEventListener('mouseup', pointerUp);

        // Touch Listeners
        wrap.addEventListener('touchstart', e => { pointerDown(e.touches[0].clientX); }, { passive: true });
        wrap.addEventListener('touchmove', e => { pointerMove(e.touches[0].clientX); }, { passive: true });
        wrap.addEventListener('touchend', pointerUp);
        wrap.addEventListener('touchcancel', pointerUp);

        // Resize
        window.addEventListener('resize', () => {
            itemWidth = getItemWidth();
            totalWidth = itemWidth * originalItems.length;
        });

        // Init
        if(originalItems.length > 0) {
            const img = originalItems[0].querySelector('img');
            if(img && !img.complete) {
                img.onload = () => { itemWidth = getItemWidth(); totalWidth = itemWidth * originalItems.length; loop(0); }
            } else { loop(0); }
        } else { loop(0); }
    }

    // --- ARTIST CIRCLE ---
    const artistCircle = document.getElementById('artistCircle');
    const artistImg = document.getElementById('artistImg');
    const artistVideo = document.getElementById('artistVideo');
    const flashOverlay = document.getElementById('flashOverlay');
    let isPlaying = false;
    artistCircle.addEventListener('click', () => {
        if (isPlaying) return;
        isPlaying = true; artistCircle.classList.add('playing');
        flashOverlay.style.opacity = '1';
        setTimeout(() => {
            flashOverlay.style.opacity = '0';
            artistImg.style.opacity = '0';
            artistVideo.style.opacity = '1';
            artistVideo.play();
        }, 100);
        artistVideo.onended = () => {
            artistVideo.style.opacity = '0';
            artistImg.style.opacity = '1';
            isPlaying = false; artistCircle.classList.remove('playing');
        };
    });

    // --- REVIEWS ---
    const reviews = [
        { name: "Familie M.", date: "vor 2 Wochen", text: "Eine wunderbare Unterstützung im Alltag. Sehr einfühlsam und zuverlässig. Wir sind sehr zufrieden!", stars: 5 },
        { name: "Herr K.", date: "vor 1 Monat", text: "Tolle Betreuung mit viel Herz. Die Begleitung tut mir sehr gut und ich freue mich immer auf die Termine.", stars: 5 }
    ];
    let currentSlide = 0; let autoSlideInterval; let isPaused = false;
    const container = document.getElementById('slidesContainer');
    const pBar = document.getElementById('progressBar');
    const widget = document.getElementById('reviewWidget');

    function initReviews() {
        reviews.forEach((rev, i) => {
            const slide = document.createElement('div');
            slide.className = `review-slide ${i === 0 ? 'active' : ''}`;
            slide.innerHTML = `
                <div class="review-header">
                    <div class="avatar">${rev.name.charAt(0)}</div>
                    <div class="user-info">
                        <div class="user-name">${rev.name}</div>
                        <div class="stars-date"><span class="stars">${'★'.repeat(rev.stars)}</span> <span>${rev.date}</span></div>
                    </div>
                </div>
                <div class="review-text">"${rev.text}"</div>
            `;
            container.appendChild(slide);
        });
        startProgress();
    }
    function showSlide(index) {
        const slides = document.querySelectorAll('.review-slide');
        slides.forEach(s => s.classList.remove('active'));
        slides[index].classList.add('active');
        currentSlide = index;
        startProgress();
    }
    function nextSlide() { currentSlide = (currentSlide + 1) % reviews.length; showSlide(currentSlide); }
    function prevSlide() { currentSlide = (currentSlide - 1 + reviews.length) % reviews.length; showSlide(currentSlide); }
    function manualChange(dir) { clearInterval(autoSlideInterval); if(dir === 1) nextSlide(); else prevSlide(); }
    function startProgress() {
        clearInterval(autoSlideInterval);
        pBar.style.width = '0%';
        if(isPaused) return;
        let width = 0;
        autoSlideInterval = setInterval(() => {
            if(!isPaused) { width += 1; pBar.style.width = width + '%'; if (width >= 100) nextSlide(); }
        }, 50); 
    }
    widget.addEventListener('mouseenter', () => { isPaused = true; widget.classList.add('paused'); });
    widget.addEventListener('mouseleave', () => { isPaused = false; widget.classList.remove('paused'); });
    initReviews();

    // --- MAP ---
    function loadMap() {
        document.getElementById('map-placeholder').style.display = 'none';
        const iframe = document.createElement('iframe');
        iframe.src = "https://maps.google.com/maps?q=Odenwaldstra%C3%9Fe+19,+72336+Balingen&t=&z=15&ie=UTF8&iwloc=&output=embed";
        iframe.allowFullscreen = true; iframe.loading = 'lazy'; iframe.referrerPolicy = 'no-referrer-when-downgrade';
        iframe.onerror = function() { document.getElementById('map-placeholder').innerHTML = '<div style="padding:40px;text-align:center;">Karte konnte nicht geladen werden.</div>'; document.getElementById('map-placeholder').style.display = 'flex'; };
        document.getElementById('map-target').appendChild(iframe);
    }

    // --- MODAL LOGIC (MIT SCROLL FIX & FORMULAR-LOGIK) ---
    function openLegalModal() {
        document.body.classList.add('no-scroll'); // Body einfrieren
        document.getElementById('legalModal').classList.add('active');
        fetch('vk-rechtstexte.html').then(r => r.text()).then(h => document.getElementById('legalContainer').innerHTML = h).catch(e => document.getElementById('legalContainer').innerHTML = "<p>Fehler beim Laden.</p>");
    }
    function closeLegalModal() { 
        document.body.classList.remove('no-scroll'); // Body freigeben
        document.getElementById('legalModal').classList.remove('active'); 
    }
    
    function openRequestModal(paketName) {
        document.body.classList.add('no-scroll'); 
        document.getElementById('requestModal').classList.add('active');
        
        const container = document.getElementById('requestContainer');
        // Lade-Spinner
        container.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 200px;"><i class="fa-solid fa-spinner fa-spin" style="font-size: 2rem; color: #ccc;"></i></div>';

        fetch('vk-kontaktformular.html')
        .then(r => r.text())
        .then(h => {
            container.innerHTML = h;

            // 1. Betreff vorauswählen und Optionen anpassen
            const select = container.querySelector('select[name="Paket"]');
if (select && paketName) {
    for (let i = 0; i < select.options.length; i++) {
        if (select.options[i].value === paketName || select.options[i].text.includes(paketName)) {
            select.selectedIndex = i;
            break;
        }
    }
}




            // 2. Flatpickr Kalender aktivieren (statisch im Modal)
            const dateInput = container.querySelector('input[name="Datum"]');
            if (window.flatpickr && dateInput) {
                flatpickr(dateInput, {
                    disableMobile: true,
                    enableTime: false,
                    dateFormat: "Y-m-d", // Maschinenlesbar
                    altInput: true,
                    altFormat: "d.m.Y",  // Nutzerfreundlich
                    minDate: "today",
                    locale: "de",
                    static: false // Kalender schwebt über Modal
                });
            }

            // 3. Formular Sende-Logik
            const form = container.querySelector('form');
            const formContent = container.querySelector('#form-content') || container.querySelector('.form-content-area');
            const successMsg = container.querySelector('#success-message') || container.querySelector('.success-message');
            
            if (form) {
                form.onsubmit = function(e) {
                    e.preventDefault();
                    
                    const btn = form.querySelector('button[type="submit"]');
                    const originalText = btn.innerHTML;
                    
                    btn.disabled = true;
                    btn.innerHTML = 'Wird gesendet...';

                    const formData = new FormData(form);

                    fetch("https://formsubmit.co/ajax/cb821965b533b1d5bc4b29eae2ce79f6", {
                        method: "POST",
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success === "true" || data.success === true) {
                            // Erfolg: Formular weg, Häkchen her
                            if(formContent) formContent.style.display = 'none';
                            else form.style.display = 'none';
                            
                            if(successMsg) successMsg.style.display = 'block';
                            
                            // Automatisch schließen nach 4 Sekunden
                            setTimeout(() => closeRequestModal(), 4000);
                        } else {
                            throw new Error(data.message || 'Fehler beim Senden');
                        }
                    })
                    .catch(error => {
                        alert("Hinweis: " + error.message + " (Bitte prüfen Sie Ihre Eingaben)");
                        btn.disabled = false;
                        btn.innerHTML = originalText;
                    });
                };
            }
            
            // Close Button für Success Message
            const closeSuccess = container.querySelector('.close-success-btn');
            if(closeSuccess) {
                closeSuccess.onclick = closeRequestModal;
            }

        }).catch(e => {
            console.error(e);
            container.innerHTML = '<p style="text-align:center; padding:20px;">Fehler beim Laden des Formulars.</p>'; 
        });
    }

    function closeRequestModal() { 
        document.body.classList.remove('no-scroll'); 
        document.getElementById('requestModal').classList.remove('active'); 
    }

    // Close Modals on Outside Click
    window.onclick = function(event) {
        if (event.target.classList.contains('modal-overlay')) {
            event.target.classList.remove('active');
            document.body.classList.remove('no-scroll');
        }
    }


    

    function closeRequestModal() { 
        document.body.classList.remove('no-scroll'); 
        document.getElementById('requestModal').classList.remove('active'); 
    }
    
    // --- KONTAKT TIMELINE SCROLL FILL EFFECT ---
    function updateContactTimelineFill() {
        const timeline = document.querySelector('.contact-timeline');
        if (!timeline) return;

        const rect = timeline.getBoundingClientRect();
        const windowHeight = window.innerHeight;

        const visibleTop = Math.max(0, windowHeight - rect.top);
        const visibleHeight = Math.min(rect.height, visibleTop);
        const fillPercentage = Math.min(100, Math.max(0, (visibleHeight / rect.height) * 100));

        const style = document.getElementById('contact-timeline-fill-style') || document.createElement('style');
        style.id = 'contact-timeline-fill-style';
        style.textContent = `.contact-timeline::after { height: ${fillPercentage}% !important; }`;
        if (!style.parentElement) document.head.appendChild(style);
    }

    window.addEventListener('scroll', updateContactTimelineFill);
    window.addEventListener('resize', updateContactTimelineFill);
    updateContactTimelineFill();

    </script>